<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    
    <meta itemprop="name" content="Pure Functional Stream processing in Scala | Mihai&#39;s blog">
    <meta itemprop="description" content="Cats and Akka – Part 1">

    
    <meta name="twitter:title" content="Pure Functional Stream processing in Scala | Mihai&#39;s blog">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:description" content="Cats and Akka – Part 1">
    <meta name="twitter:site" content="@mihaisafta_">
    <meta name="twitter:creator" content="@mihaisafta_">
    <meta name="twitter:image:src" content="https://saftacatalinmihai.github.io/11rblog//11rblog/twitter.jpg">

    
    <meta name="og:title" content="Pure Functional Stream processing in Scala | Mihai&#39;s blog">
    <meta name="og:description" content="Cats and Akka – Part 1">
    <meta name="og:image" content="https://saftacatalinmihai.github.io/11rblog//11rblog/og.jpg">
    <meta name="og:url" content="https://saftacatalinmihai.github.io/11rblog//11rblog/">
    <meta name="og:site_name" content="Mihai&#39;s blog">
    <meta name="og:locale" content="en_GB">
    <meta name="og:type" content="website">

    <link rel="icon" type="image/x-icon" href="/11rblog/favicon.ico" />

    <title>Pure Functional Stream processing in Scala | Mihai&#39;s blog</title>

    <link rel="stylesheet" href="/11rblog/assets/main.bundle.css">

    
  </head>
  <body class="flex flex-col min-h-screen">
    
    <header>
  <nav class="container mx-auto max-w-3xl px-8 pt-2 flex flex-wrap justify-between">
    <div>
      <h1>
        <a href="/11rblog/">Mihai&#39;s blog</a>
      </h1>
      <p>phylosopher of computation</p>
    </div>

    <ul class="flex flex-wrap sm:w-32 w-full mt-6 md:justify-between justify-evenly">
      <li>
        <a href="/11rblog/404.html">404</a>
      </li>

      <li>
        <a href="/11rblog/about">About</a>
      </li>
    </ul>
  </nav>
</header>
    <main class="container mx-auto max-w-3xl p-8 grow">
      
    <p></p>
    <div>
        <h2>Pure Functional Stream processing in Scala</h2>

        
            <p class="excerpt">Cats and Akka – Part 1</p>
        

        
            <div class="mb-2">
                <a class="tag scala" href="/11rblog/tag/scala">scala</a><a class="tag cats" href="/11rblog/tag/cats">cats</a><a class="tag akka" href="/11rblog/tag/akka">akka</a>
            </div>
        

        
            
                <p class="text-sm italic">Created on
                    <span datetime="Sat Feb 06 2021 02:00:00 GMT+0200 (Eastern European Standard Time)">February 6, 2021</span>.</p>
            
        

        <div class="content post">
            
                <hr />

                <h3>Table of Contents</h3>

                <nav class="toc">
                <ol>
                    
                    <li><a href="#pure-functional-programming-in-scala">Pure Functional Programming in Scala</a>
            		</li>

                    <li><a href="#stream-processing-in-scala">Stream processing in Scala</a>
            		</li>
                </ol>
            </nav>

                <hr />
            

            <p>In Scala you can write pure functional code, similar to Haskell or other pure functional languages, but you’re not obligated to. Wikipedia categories Scala as an impure Functional language.</p>
<p>FP purists view this as a weakness of Scala, but others view the option of “cheating” pureness as an acceptable choice sometimes. Even if you can do everything purely, it’s sometimes a lot easier to think about the problem in a different paradigm.</p>
<p>Pure FP is great for writing correct functions you can easily reason about in isolation and compose well with other pure functions. We can easily unit test them since pure functions only depend on their input arguments and always produce the same output for the same arguments – they are referentially transparent.</p>
<p>This allows the programmer and the compiler to reason about program behavior as a rewrite system. This can help in proving correctness, simplifying an algorithm, help change code without breaking it, or optimizing code through memoization, common sub-expression elimination, lazy evaluation, or parallelization.</p>
<hr>
<p>There are, however, other approaches to thinking about compossibility of programs.</p>
<p>One such approach is to think of software components as black boxes running a process.
They have a variable number of input and output ports which have Types associated to them.
Messages pass asynchronously from component to component after linking their corresponding ports together (if the types match).
We specify the connections outside the components themselves.
This is the thinking behind flow based programming.
(This is also how microservices work at a larger scale)</p>
<p>My view is that these two ways of thinking about composable programs are not mutually exclusive and they can work together in synergy. I will try to make this case by the end of this post.</p>
<hr>
<h3 id="pure-functional-programming-in-scala" tabindex="-1">Pure Functional Programming in Scala</h3>
<p>Using Cats, you can use Type Classes: Functor, Applicative, Monad etc… to model your programs based on these highly general computational abstractions.
There are other ecosystems for pure FP in Scala. I chose Cats because I’m most familiar with it.</p>
<p>Adding Cats-effect, you can also model IO in a pure functional way. The idea is to write the entire program, including all the effects like: calling external services, writing to file, pushing messages to queues, as a single composed expression that returns an IO data structure representing the action of running all these effects, without actually running them. You only execute them at the “end of the world” in the “main” method.</p>
<p>This is a simple example of a pure functional program using cats-effect.</p>
<pre class="language-scala"><code class="language-scala"><span class="token keyword">import</span> <span class="token namespace">cats<span class="token punctuation">.</span>effect<span class="token punctuation">.</span></span><span class="token punctuation">{</span> IO<span class="token punctuation">,</span> Sync <span class="token punctuation">}</span><br><span class="token keyword">import</span> <span class="token namespace">cats<span class="token punctuation">.</span>implicits<span class="token punctuation">.</span></span>_<br><span class="token keyword">import</span> <span class="token namespace">scala<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>StdIn<br><br><span class="token keyword">object</span> App <span class="token punctuation">{</span><br><br>  <span class="token keyword">def</span> getUserName<span class="token punctuation">[</span>F<span class="token punctuation">[</span>_<span class="token punctuation">]</span><span class="token operator">:</span> Sync<span class="token punctuation">]</span><span class="token operator">:</span> F<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span><br>    <span class="token keyword">for</span> <span class="token punctuation">{</span><br>      _    <span class="token keyword">&lt;-</span> Sync<span class="token punctuation">[</span>F<span class="token punctuation">]</span><span class="token punctuation">.</span>delay<span class="token punctuation">(</span>println<span class="token punctuation">(</span><span class="token string">"What's your name?"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>      name <span class="token keyword">&lt;-</span> Sync<span class="token punctuation">[</span>F<span class="token punctuation">]</span><span class="token punctuation">.</span>delay<span class="token punctuation">(</span>StdIn<span class="token punctuation">.</span>readLine<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span> <span class="token keyword">yield</span> name<br><br>  <span class="token keyword">def</span> greatUser<span class="token punctuation">[</span>F<span class="token punctuation">[</span>_<span class="token punctuation">]</span><span class="token operator">:</span> Sync<span class="token punctuation">]</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span> F<span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span> <span class="token operator">=</span><br>    Sync<span class="token punctuation">[</span>F<span class="token punctuation">]</span><span class="token punctuation">.</span>delay<span class="token punctuation">(</span>println<span class="token punctuation">(</span>s<span class="token string">"Hello $name!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><br>  <span class="token keyword">def</span> program<span class="token punctuation">[</span>F<span class="token punctuation">[</span>_<span class="token punctuation">]</span><span class="token operator">:</span> Sync<span class="token punctuation">]</span><span class="token operator">:</span> F<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">for</span> <span class="token punctuation">{</span><br>    name <span class="token keyword">&lt;-</span> getUserName<br>    _    <span class="token keyword">&lt;-</span> greatUser<span class="token punctuation">(</span>name<span class="token punctuation">)</span><br>  <span class="token punctuation">}</span> <span class="token keyword">yield</span> s<span class="token string">"Greeted $name"</span><br><br>  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span><br>    program<span class="token punctuation">[</span>IO<span class="token punctuation">]</span><span class="token punctuation">.</span>unsafeRunSync<span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>Real programs will, of course, be much more complex, but it all boils down to a single IO value that combines all the effects of running the program which we execute in the “main” method.</p>
<p>Runar has a great talk where he compares using pure FP and IO as working with unexploded TNT. That is much easier to work with as opposed to working with exploded TNT (by actually executing effects in each function).</p>
<h3 id="stream-processing-in-scala" tabindex="-1">Stream processing in Scala</h3>
<p>Akka Streams implements the Reactive Streams protocol that’s now standardised in the JVM ecosystem.</p>
<p>Streams have added benefits over simple functions by implementing flow control mechanisms which include back-pressure.</p>
<p>You can think of streams as managed functions, similar to how the Operating System manages threads.</p>
<p>A stream component can decide when to ask for more input messages to pass to its processing function, how many parallel calls to the function to allow, and whether to slow down processing because there is no demand from downstream functions.</p>
<p>Akka is using the abstractions of Source, Flow, Sink for modeling streams.</p>
<p align="center">
    <img alt="source-flow-sink" title="Source via Flow to Sink" src="/11rblog/SourceFlowSink-4.png">
</p>
<!-- ![source-flow-sink](/11rblog/SourceFlowSink-4.png "Source via Flow to Sink") -->
        </div>
            <p class="uppercase text-xs mt-6">Previous</p>

            <p class="font-bold">
                <a href="/11rblog/post/deadbeef-decrementation/">Deadbeef Decrementation</a>
            </p>
        
    </div>

    </main>
    <footer class="bg-gray-900 pb-10">
   <p class="block text-center text-sm mb-6">
    Built by
    <a target="_blank" href="http://twitter.com/mihaisafta_">
      Safta Catalin Mihai
    </a>
  </p>

  <p class="block text-center text-sm mb-6">
    eleventy template by
    <a target="_blank" href="https://github.com/reeseschultz">
      Reese Schultz
    </a>
  </p>

  <a class="block text-center text-sm" href="/11rblog/privacy-policy">Privacy Policy</a>
</footer>
    <div id="privacy-notice" style="height: 5em" class="sticky bottom-0 py-5 px-2 bg-gray-800 w-full flex justify-center">
    <p class="px-2 text-sm self-center">By using this site, you agree that you have read and understand its <a href="/11rblog/privacy-policy">Privacy Policy</a>.</p>
    <button aria-label="dismiss" style="height: 32px; width: 32px" class="flex justify-center align-center" id="privacy-notice-button-container">
        <svg id="privacy-notice-button" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18"><path d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z"/></svg> 
    </button>
</div>

    <script src="https://unpkg.com/clipboard@2/dist/clipboard.min.js"></script>
    <script src="/11rblog/assets/main.bundle.js"></script>
  </body>
</html>
